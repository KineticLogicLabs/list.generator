<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Test Formatter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f8fafc;
            color: #1e293b;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        textarea {
            resize: none;
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.6;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            margin-bottom: 0.4rem;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .config-row {
            display: grid;
            grid-template-columns: 3.5rem 1fr 3rem;
            gap: 0.5rem;
            align-items: center;
            padding: 0.4rem 0.75rem;
            background: #ffffff;
            border-radius: 6px;
            margin-bottom: 0.25rem;
            border: 1px solid #e2e8f0;
        }
        .section-input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 0.5rem;
        }
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .hidden { display: none; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <h1 class="text-3xl font-black text-slate-800 tracking-tight">Test Formatter Pro</h1>
                <p class="text-slate-500">Professional numbering for complex test structures.</p>
            </div>
            <button onclick="copyToClipboard()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-6 rounded-lg shadow-lg transition active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                Copy Document
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <!-- Settings Panel -->
            <div class="lg:col-span-5 card p-6 border border-slate-200 sticky top-8">
                <h2 class="text-sm font-black text-slate-400 mb-6 uppercase tracking-widest border-b pb-2">Layout & Structure</h2>

                <!-- Mode Switcher -->
                <div class="flex p-1 bg-slate-100 rounded-lg mb-6">
                    <button id="tabSingle" onclick="setMode('single')" class="flex-1 py-2 text-sm font-bold rounded-md transition-all bg-white shadow-sm text-blue-600">Single List</button>
                    <button id="tabMulti" onclick="setMode('multi')" class="flex-1 py-2 text-sm font-bold rounded-md transition-all text-slate-500 hover:text-slate-700">Multi-Section</button>
                </div>

                <!-- Basic Question Count (Single Mode Only) -->
                <div id="singleModeSettings" class="form-group">
                    <label for="count">Number of Questions</label>
                    <input type="number" id="count" value="10" onfocus="this.select()" oninput="handleStructureChange()" class="w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5 border">
                </div>

                <!-- Multi Section Settings (Multi Mode Only) -->
                <div id="multiModeSettings" class="hidden space-y-4 mb-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="sectionCount">Number of Sections</label>
                            <input type="number" id="sectionCount" value="2" min="1" onfocus="this.select()" oninput="renderSectionGrid()" class="w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5 border">
                        </div>
                        <div class="form-group">
                            <label for="headerFormat">Header Text Style</label>
                            <select id="headerFormat" onchange="generateList()" class="w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5 border">
                                <option value="section-num">SECTION 1</option>
                                <option value="section-num-lc">Section 1</option>
                                <option value="section-roman">SECTION I</option>
                                <option value="part-num">PART 1</option>
                                <option value="plain-num">1.</option>
                                <option value="roman-only">I.</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 p-2 bg-slate-50 rounded border mb-2">
                        <input type="checkbox" id="headerDivider" checked onchange="generateList()" class="w-4 h-4 text-blue-600 rounded cursor-pointer">
                        <label for="headerDivider" class="mb-0 text-[10px] cursor-pointer">Include Divider Line (=====)</label>
                    </div>

                    <div class="form-group">
                        <label>Questions per Section</label>
                        <div id="sectionInputsContainer" class="section-input-grid">
                            <!-- Section Inputs -->
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="form-group">
                        <label for="spacing">Question Spacing</label>
                        <input type="number" id="spacing" value="2" min="0" onfocus="this.select()" class="w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5 border">
                    </div>
                    <div class="form-group">
                        <label>Style</label>
                        <div class="flex gap-1">
                            <button onclick="setStyle('paren')" id="btnParen" class="flex-1 py-2 rounded-md border text-sm font-bold transition-all bg-blue-50 border-blue-200 text-blue-700">1)</button>
                            <button onclick="setStyle('dot')" id="btnDot" class="flex-1 py-2 rounded-md border text-sm font-bold transition-all bg-white border-slate-200 text-slate-600">1.</button>
                        </div>
                    </div>
                </div>

                <!-- Sub-Question Feature Toggle -->
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200 mb-6">
                    <input type="checkbox" id="enableSubQuestions" onchange="toggleSubQMenu()" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 cursor-pointer">
                    <div>
                        <label for="enableSubQuestions" class="mb-0 text-slate-800 font-bold cursor-pointer normal-case text-sm">Enable Sub-Questions</label>
                        <p class="text-[10px] text-slate-400 font-medium">Customize individual questions with a, b, c...</p>
                    </div>
                </div>

                <!-- Sub-Question Menu (Conditional) -->
                <div id="subQMenu" class="hidden animate-in fade-in slide-in-from-top-2 duration-200">
                    <div class="form-group mb-4">
                        <label for="subSpacing">Sub-Question Spacing</label>
                        <input type="number" id="subSpacing" value="1" min="0" onfocus="this.select()" class="w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5 border">
                    </div>
                    
                    <label>Question Customizer</label>
                    <div id="questionList" class="max-h-[250px] overflow-y-auto pr-2 custom-scroll border rounded-lg p-2 bg-slate-50 shadow-inner">
                        <!-- Questions listed here for sub-q selection -->
                    </div>
                </div>

                <button onclick="generateList()" class="w-full mt-6 bg-slate-800 hover:bg-slate-900 text-white font-bold py-3.5 px-4 rounded-xl transition transform active:scale-95 shadow-lg">
                    Update Preview
                </button>
            </div>

            <!-- Output Panel -->
            <div class="lg:col-span-7">
                <div class="relative">
                    <textarea id="result" class="w-full h-[800px] card p-10 text-lg border-slate-200 focus:ring-2 focus:ring-blue-500 shadow-inner" readonly placeholder="Generator results will appear here..."></textarea>
                    
                    <div id="copyToast" class="absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-2 rounded-full text-sm font-medium opacity-0 transition-all pointer-events-none translate-y-2">
                        Copied to clipboard!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStyle = 'paren';
        let currentMode = 'single';
        let questionData = []; 

        function toRoman(num) {
            const map = { M: 1000, CM: 900, D: 500, CD: 400, C: 100, XC: 90, L: 50, XL: 40, X: 10, IX: 9, V: 5, IV: 4, I: 1 };
            let result = '';
            for (let key in map) {
                while (num >= map[key]) {
                    result += key;
                    num -= map[key];
                }
            }
            return result;
        }

        function setMode(mode) {
            currentMode = mode;
            const isMulti = mode === 'multi';
            document.getElementById('singleModeSettings').classList.toggle('hidden', isMulti);
            document.getElementById('multiModeSettings').classList.toggle('hidden', !isMulti);
            
            const tabSingle = document.getElementById('tabSingle');
            const tabMulti = document.getElementById('tabMulti');
            
            if (isMulti) {
                tabMulti.className = "flex-1 py-2 text-sm font-bold rounded-md transition-all bg-white shadow-sm text-blue-600";
                tabSingle.className = "flex-1 py-2 text-sm font-bold rounded-md transition-all text-slate-500 hover:text-slate-700";
                renderSectionGrid();
            } else {
                tabSingle.className = "flex-1 py-2 text-sm font-bold rounded-md transition-all bg-white shadow-sm text-blue-600";
                tabMulti.className = "flex-1 py-2 text-sm font-bold rounded-md transition-all text-slate-500 hover:text-slate-700";
            }
            handleStructureChange();
        }

        function renderSectionGrid() {
            const container = document.getElementById('sectionInputsContainer');
            const count = parseInt(document.getElementById('sectionCount').value) || 0;
            const safeCount = Math.min(count, 50);
            
            const currentInputs = Array.from(container.querySelectorAll('input')).map(i => i.value);
            container.innerHTML = '';
            
            for (let i = 0; i < safeCount; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.value = currentInputs[i] || '5';
                input.placeholder = `S${i+1}`;
                input.onfocus = function() { this.select(); };
                input.oninput = handleStructureChange;
                input.className = "w-full rounded border-slate-200 text-center text-sm p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 border bg-white shadow-sm";
                container.appendChild(input);
            }
            handleStructureChange();
        }

        function toggleSubQMenu() {
            const enabled = document.getElementById('enableSubQuestions').checked;
            document.getElementById('subQMenu').classList.toggle('hidden', !enabled);
            if (enabled) handleStructureChange();
        }

        function handleStructureChange() {
            const isMulti = currentMode === 'multi';
            let newStructure = [];

            if (!isMulti) {
                const count = parseInt(document.getElementById('count').value) || 0;
                for (let i = 1; i <= count; i++) {
                    newStructure.push({ label: `${i}`, key: `q-${i}` });
                }
            } else {
                const sectionInputs = Array.from(document.getElementById('sectionInputsContainer').querySelectorAll('input'));
                sectionInputs.forEach((input, sIdx) => {
                    const qCount = parseInt(input.value) || 0;
                    for (let qIdx = 1; qIdx <= qCount; qIdx++) {
                        newStructure.push({ 
                            label: `S${sIdx + 1}-Q${qIdx}`, 
                            key: `s${sIdx}-q${qIdx}`,
                            sectionIdx: sIdx,
                            qNumber: qIdx
                        });
                    }
                });
            }

            questionData = newStructure.map(item => {
                const existing = questionData.find(d => d.key === item.key);
                return {
                    ...item,
                    hasSub: existing ? existing.hasSub : false,
                    subCount: existing ? existing.subCount : 2
                };
            });

            renderQuestionCustomizer();
        }

        function renderQuestionCustomizer() {
            const container = document.getElementById('questionList');
            container.innerHTML = '';

            questionData.forEach((q) => {
                const row = document.createElement('div');
                row.className = "config-row";

                const label = document.createElement('span');
                label.className = "text-[10px] font-black text-slate-400";
                label.textContent = q.label;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = q.hasSub;
                checkbox.className = "w-4 h-4 text-blue-600 rounded focus:ring-blue-500 cursor-pointer mx-auto";
                checkbox.onchange = (e) => {
                    q.hasSub = e.target.checked;
                    renderQuestionCustomizer();
                };

                const inputContainer = document.createElement('div');
                if (q.hasSub) {
                    const subInput = document.createElement('input');
                    subInput.type = 'number';
                    subInput.value = q.subCount;
                    subInput.min = '1';
                    subInput.onfocus = function() { this.select(); };
                    subInput.oninput = (e) => { q.subCount = parseInt(e.target.value) || 1; };
                    subInput.className = "w-full rounded border-slate-200 text-center text-xs p-1 border bg-white";
                    inputContainer.appendChild(subInput);
                }

                row.appendChild(label);
                row.appendChild(checkbox);
                row.appendChild(inputContainer);
                container.appendChild(row);
            });
        }

        function setStyle(style) {
            currentStyle = style;
            const btnParen = document.getElementById('btnParen');
            const btnDot = document.getElementById('btnDot');
            btnParen.className = style === 'paren' ? "flex-1 py-2 rounded-md border text-sm font-bold transition-all bg-blue-50 border-blue-200 text-blue-700 shadow-sm" : "flex-1 py-2 rounded-md border text-sm font-bold transition-all bg-white border-slate-200 text-slate-600 hover:bg-slate-50";
            btnDot.className = style === 'dot' ? "flex-1 py-2 rounded-md border text-sm font-bold transition-all bg-blue-50 border-blue-200 text-blue-700 shadow-sm" : "flex-1 py-2 rounded-md border text-sm font-bold transition-all bg-white border-slate-200 text-slate-600 hover:bg-slate-50";
            generateList();
        }

        function generateList() {
            const spacing = parseInt(document.getElementById('spacing').value) || 0;
            const subSpacing = parseInt(document.getElementById('subSpacing').value) || 0;
            const textarea = document.getElementById('result');
            const suffix = currentStyle === 'paren' ? ')' : '.';
            const alphabet = "abcdefghijklmnopqrstuvwxyz".split("");
            const enableSubs = document.getElementById('enableSubQuestions').checked;
            
            // Header Stylings
            const hFormat = document.getElementById('headerFormat').value;
            const showDivider = document.getElementById('headerDivider').checked;

            let output = "";
            let currentSection = -1;

            questionData.forEach((q) => {
                if (currentMode === 'multi' && q.sectionIdx !== currentSection) {
                    currentSection = q.sectionIdx;
                    const num = currentSection + 1;
                    let hText = "";
                    
                    switch(hFormat) {
                        case 'section-num': hText = `SECTION ${num}`; break;
                        case 'section-num-lc': hText = `Section ${num}`; break;
                        case 'section-roman': hText = `SECTION ${toRoman(num)}`; break;
                        case 'part-num': hText = `PART ${num}`; break;
                        case 'plain-num': hText = `${num}.`; break;
                        case 'roman-only': hText = `${toRoman(num)}.`; break;
                    }

                    output += `\n${hText}\n`;
                    if (showDivider) {
                        output += "=".repeat(hText.length + 4) + "\n";
                    }
                    output += "\n";
                }

                const displayNum = currentMode === 'single' ? q.label : q.qNumber;
                output += `${displayNum}${suffix}\n`;
                
                if (enableSubs && q.hasSub) {
                    for (let j = 0; j < q.subCount; j++) {
                        output += `   ${alphabet[j % 26]}${suffix}${ "\n".repeat(subSpacing + 1) }`;
                    }
                    output += "\n".repeat(spacing);
                } else {
                    output += "\n".repeat(spacing);
                }
            });

            textarea.value = output.trim();
        }

        function copyToClipboard() {
            const textarea = document.getElementById('result');
            textarea.select();
            document.execCommand('copy');
            const toast = document.getElementById('copyToast');
            toast.style.opacity = '1';
            toast.style.transform = 'translatex(-50%) translatey(0)';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translatex(-50%) translatey(8px)';
                window.getSelection().removeAllRanges();
            }, 2000);
        }

        window.onload = () => {
            setMode('single');
        };
    </script>
</body>
</html>
